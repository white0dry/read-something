@import url("/fonts/ping-fang-shao-hua/result.css");

@tailwind base;
@tailwind components;

:root {
        --neu-bg: #e0e5ec;
        --neu-text: #64748b; 
        --neu-shadow-light: #ffffff;
        --neu-shadow-dark: #a3b1c6;
        --neu-highlight: #e28a9d; 
        --app-font-scale: 1;
        --app-screen-height: 100vh;
        
        /* Default Theme Colors (Rose-ish) - Will be overridden by JS */
        --theme-50: 253 242 244;
        --theme-100: 252 231 234;
        --theme-200: 248 208 217;
        --theme-300: 240 171 184;
        --theme-400: 226 138 157;
        --theme-500: 212 114 136;
        --theme-600: 190 83 107;
        --theme-700: 160 63 86;
        --theme-800: 134 54 74;
        --theme-900: 113 48 65;
      }

      @supports (height: 100dvh) {
        :root {
          --app-screen-height: 100dvh;
        }
      }
      
      /* Dark mode variables */
      .dark-mode {
        --neu-bg: #2d3748;
        --neu-text: #e2e8f0;
        --neu-shadow-light: #374357; 
        --neu-shadow-dark: #232b39;
        --neu-highlight: #f0abb8;
      }

      /* Fix Scrollbars & Layout */
      html,
      body,
      #root {
        width: 100%;
        min-height: var(--app-screen-height);
        height: var(--app-screen-height);
      }

      html, body {
        margin: 0;
        padding: 0;
        overflow: hidden; /* Prevent body scroll */
        overscroll-behavior: none;
        background-color: var(--neu-bg);
        color: var(--neu-text);
        transition: background-color 0.3s ease, color 0.3s ease, font-size 0.3s ease;
      }

      /* Custom scrollbar for a cleaner look */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: var(--neu-shadow-dark);
        border-radius: 3px;
        opacity: 0.5;
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }

      /* Reader scroll area: keep right scrollbar visible and draggable */
      .reader-scroll-panel {
        scrollbar-gutter: stable;
        scrollbar-width: auto;
      }
      .reader-scroll-panel::-webkit-scrollbar {
        width: 12px;
      }
      .reader-scroll-panel::-webkit-scrollbar-track {
        background: rgb(148 163 184 / 0.18);
        border-radius: 9999px;
      }
      .reader-scroll-panel::-webkit-scrollbar-thumb {
        background: rgb(100 116 139 / 0.65);
        border-radius: 9999px;
        border: 2px solid transparent;
        background-clip: padding-box;
      }
      .dark-mode .reader-scroll-panel::-webkit-scrollbar-track {
        background: rgb(71 85 105 / 0.4);
      }
      .dark-mode .reader-scroll-panel::-webkit-scrollbar-thumb {
        background: rgb(148 163 184 / 0.55);
      }

      /* Reader消息面板: always hide scrollbars across browsers/PWA */
      .reader-message-scroll {
        -ms-overflow-style: none;
        scrollbar-width: none;
        scrollbar-gutter: auto;
      }
      .reader-message-scroll::-webkit-scrollbar {
        width: 0 !important;
        height: 0 !important;
        display: none;
      }
      .reader-message-scroll::-webkit-scrollbar-track {
        background: transparent;
      }
      .reader-message-scroll::-webkit-scrollbar-thumb {
        background: transparent;
      }

      /* Reader正文: keep thumb visible but make track invisible */
      .reader-content-scroll {
        scrollbar-width: none;
        scrollbar-color: transparent transparent;
        -webkit-overflow-scrolling: touch;
        touch-action: pan-y;
      }
      .reader-content-scroll::-webkit-scrollbar {
        width: 0;
        height: 0;
      }
      .reader-content-scroll::-webkit-scrollbar-track {
        background: transparent;
      }
      .reader-content-scroll::-webkit-scrollbar-thumb {
        border-radius: 9999px;
        min-height: 36px;
        background: transparent;
      }
      .dark-mode .reader-content-scroll {
        scrollbar-color: transparent transparent;
      }
      .dark-mode .reader-content-scroll::-webkit-scrollbar-track {
        background: transparent;
      }
      .dark-mode .reader-content-scroll::-webkit-scrollbar-thumb {
        border-radius: 9999px;
        min-height: 36px;
        background: transparent;
      }

      @keyframes reader-chapter-out-up {
        from { transform: translateY(0); opacity: 1; }
        to { transform: translateY(-20px); opacity: 0; }
      }
      @keyframes reader-chapter-out-down {
        from { transform: translateY(0); opacity: 1; }
        to { transform: translateY(20px); opacity: 0; }
      }
      @keyframes reader-chapter-in-up {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
      @keyframes reader-chapter-in-down {
        from { transform: translateY(-20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
      .reader-chapter-out-up {
        animation: reader-chapter-out-up 120ms ease-out both;
        will-change: transform, opacity;
      }
      .reader-chapter-out-down {
        animation: reader-chapter-out-down 120ms ease-out both;
        will-change: transform, opacity;
      }
      .reader-chapter-in-up {
        animation: reader-chapter-in-up 180ms ease-out both;
        will-change: transform, opacity;
      }
      .reader-chapter-in-down {
        animation: reader-chapter-in-down 180ms ease-out both;
        will-change: transform, opacity;
      }

      @keyframes reader-flyout-expand-down {
        from {
          opacity: 0;
          transform: translateY(-8px) scaleY(0.88);
        }
        to {
          opacity: 1;
          transform: translateY(0) scaleY(1);
        }
      }

      @keyframes reader-flyout-collapse-up {
        from {
          opacity: 1;
          transform: translateY(0) scaleY(1);
        }
        to {
          opacity: 0;
          transform: translateY(-8px) scaleY(0.88);
        }
      }

      .reader-flyout-enter {
        transform-origin: top center;
        animation: reader-flyout-expand-down 220ms cubic-bezier(0.22, 1, 0.36, 1) both;
        will-change: transform, opacity;
      }

      .reader-flyout-exit {
        transform-origin: top center;
        animation: reader-flyout-collapse-up 220ms ease-in both;
        will-change: transform, opacity;
      }

      /* Neumorphism Utilities */
      .neu-bg { background-color: var(--neu-bg); }
      .neu-text { color: var(--neu-text); }
      
      .neu-flat {
        background: var(--neu-bg);
        box-shadow: 6px 6px 12px var(--neu-shadow-dark), -6px -6px 12px var(--neu-shadow-light);
        border-radius: 1rem;
        border: none;
      }
      
      .neu-pressed {
        background: var(--neu-bg);
        box-shadow: inset 5px 5px 10px var(--neu-shadow-dark), inset -5px -5px 10px var(--neu-shadow-light);
        border-radius: 1rem;
        border: none;
      }

      .neu-card-pressable {
        transition: box-shadow 150ms ease;
      }
      .neu-card-pressable:active {
        box-shadow: inset 3px 3px 6px var(--neu-shadow-dark), inset -3px -3px 6px var(--neu-shadow-light) !important;
      }

      .neu-btn {
        background: var(--neu-bg);
        box-shadow: 5px 5px 10px var(--neu-shadow-dark), -5px -5px 10px var(--neu-shadow-light);
        border-radius: 9999px; /* Pill/Circle */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        color: var(--neu-text);
        border: none;
        cursor: pointer;
      }
      
      .neu-btn:active, .neu-btn-active {
        box-shadow: inset 3px 3px 6px var(--neu-shadow-dark), inset -3px -3px 6px var(--neu-shadow-light);
        color: var(--neu-highlight); /* This variable needs to update with theme too */
        transform: translateY(1px);
      }

      /* Toggle-style pressed state: keep inset look without extra movement */
      .reader-tool-active {
        box-shadow: inset 3px 3px 6px var(--neu-shadow-dark), inset -3px -3px 6px var(--neu-shadow-light);
      }

      /* Highlighter toggle: avoid transient :active flash, rely on persistent pressed state */
      .reader-tool-toggle {
        transition: color 0.2s ease, box-shadow 0.12s ease;
      }
      .reader-tool-toggle:active {
        transform: none;
        box-shadow: 5px 5px 10px var(--neu-shadow-dark), -5px -5px 10px var(--neu-shadow-light);
      }
      .reader-tool-toggle.reader-tool-active:active {
        transform: none;
        box-shadow: inset 3px 3px 6px var(--neu-shadow-dark), inset -3px -3px 6px var(--neu-shadow-light);
      }

      .reader-ai-fab {
        transition: color 0.2s ease, box-shadow 0.14s ease, transform 0.14s ease, opacity 0.2s ease;
      }
      .reader-ai-fab:active,
      .reader-ai-fab.neu-btn-active {
        color: rgb(var(--theme-500) / 1) !important;
      }

      .reader-ai-fab-badge {
        transform-origin: top right;
        transition: transform 180ms cubic-bezier(0.22, 1, 0.36, 1), opacity 180ms ease;
      }

      @keyframes reader-bubble-enter-left {
        from {
          opacity: 0;
          transform: translateX(-14px) scale(0.92);
        }
        to {
          opacity: 1;
          transform: translateX(0) scale(1);
        }
      }

      @keyframes reader-bubble-enter-right {
        from {
          opacity: 0;
          transform: translateX(14px) scale(0.92);
        }
        to {
          opacity: 1;
          transform: translateX(0) scale(1);
        }
      }

      .reader-bubble-enter-left {
        transform-origin: left bottom;
        animation: reader-bubble-enter-left 260ms cubic-bezier(0.22, 1, 0.36, 1) both;
        will-change: transform, opacity;
      }

      .reader-bubble-enter-right {
        transform-origin: right bottom;
        animation: reader-bubble-enter-right 260ms cubic-bezier(0.22, 1, 0.36, 1) both;
        will-change: transform, opacity;
      }

      @keyframes reader-typing-breath {
        0%,
        100% {
          opacity: 0.45;
        }
        50% {
          opacity: 1;
        }
      }

      .reader-typing-breath {
        animation: reader-typing-breath 1.4s ease-in-out infinite;
      }

      /* Card press feedback for clickable book cards */
      .app-card-press {
        transition: transform 160ms cubic-bezier(0.22, 1, 0.36, 1), box-shadow 160ms ease, filter 160ms ease;
        transform-origin: center;
      }
      .app-card-press:active {
        transform: translateY(1px) scale(0.978);
        box-shadow: inset 4px 4px 8px var(--neu-shadow-dark), inset -4px -4px 8px var(--neu-shadow-light);
        filter: saturate(0.96);
      }
      .app-card-press-media {
        transition: transform 160ms ease, opacity 160ms ease;
      }
      .app-card-press:active .app-card-press-media {
        transform: scale(0.985);
      }

      /* Library grid cover: softer inset press to match neumorphic import card */
      .lib-cover-card-press {
        transition: transform 170ms cubic-bezier(0.22, 1, 0.36, 1), box-shadow 190ms ease, filter 190ms ease;
        transform-origin: center;
      }
      .lib-cover-card-press:active {
        transform: translateY(1px) scale(0.982);
        box-shadow: inset 5px 5px 10px var(--neu-shadow-dark), inset -5px -5px 10px var(--neu-shadow-light);
        filter: saturate(0.98);
      }
      .lib-cover-card-media {
        transition: opacity 170ms ease;
      }
      .lib-cover-card-press:active .lib-cover-card-media {
        opacity: 0.94;
      }
      
      .neu-input {
        background: var(--neu-bg);
        box-shadow: inset 4px 4px 8px var(--neu-shadow-dark), inset -4px -4px 8px var(--neu-shadow-light);
        border-radius: 9999px;
        border: none;
        outline: none;
        color: var(--neu-text);
      }

      @keyframes app-view-enter-left {
        0% {
          transform: translateX(-24px);
          opacity: 0;
        }
        100% {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes app-view-exit-right {
        0% {
          transform: translateX(0);
          opacity: 1;
        }
        100% {
          transform: translateX(24px);
          opacity: 0;
        }
      }

      @keyframes app-modal-overlay-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes app-modal-overlay-out {
        from { opacity: 1; }
        to { opacity: 0; }
      }

      @keyframes app-fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes app-fade-out {
        from { opacity: 1; }
        to { opacity: 0; }
      }

      .app-view-enter-left {
        position: relative;
        animation: app-view-enter-left 260ms cubic-bezier(0.22, 1, 0.36, 1) both;
        will-change: transform, opacity;
      }

      .app-view-exit-right {
        position: relative;
        animation: app-view-exit-right 260ms cubic-bezier(0.22, 1, 0.36, 1) both;
        will-change: transform, opacity;
      }

      .app-modal-enter-left {
        position: relative;
        animation: app-view-enter-left 240ms cubic-bezier(0.22, 1, 0.36, 1) both;
        will-change: transform, opacity;
      }

      .app-modal-exit-right {
        position: relative;
        animation: app-view-exit-right 240ms cubic-bezier(0.22, 1, 0.36, 1) both;
        will-change: transform, opacity;
      }

      .app-modal-overlay-enter {
        animation: app-modal-overlay-in 240ms ease-out both;
      }

      .app-modal-overlay-exit {
        animation: app-modal-overlay-out 240ms ease-in both;
      }

      .app-fade-enter {
        animation: app-fade-in 220ms ease-out both;
      }

      .app-fade-exit {
        animation: app-fade-out 220ms ease-in both;
      }

      @keyframes stats-slide-in-left {
        from {
          opacity: 0;
          transform: translateX(24px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      @keyframes stats-slide-in-right {
        from {
          opacity: 0;
          transform: translateX(-24px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .stats-slide-left {
        animation: stats-slide-in-left 240ms cubic-bezier(0.22, 1, 0.36, 1) both;
        will-change: transform, opacity;
      }

      .stats-slide-right {
        animation: stats-slide-in-right 240ms cubic-bezier(0.22, 1, 0.36, 1) both;
        will-change: transform, opacity;
      }

      .stats-swipe-surface {
        touch-action: pan-y;
        overscroll-behavior-x: contain;
        -webkit-user-select: none;
        user-select: none;
      }

      .stats-week-chart :focus,
      .stats-week-chart :focus-visible {
        outline: none !important;
      }

      .stats-week-chart .recharts-surface {
        -webkit-tap-highlight-color: transparent;
      }

      .stats-note-wrap {
        position: relative;
        width: min(100%, 15.8rem);
        height: 100%;
        max-height: 100%;
        transform: rotate(-1deg);
      }

      .stats-note-tape {
        position: absolute;
        top: -0.75rem;
        left: 50%;
        transform: translateX(-50%) rotate(2deg);
        width: 5.1rem;
        height: 1.5rem;
        pointer-events: none;
        background: rgba(255, 255, 255, 0.4);
        backdrop-filter: blur(2px);
        border-left: 1px dashed rgba(0, 0, 0, 0.1);
        border-right: 1px dashed rgba(0, 0, 0, 0.1);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        z-index: 2;
      }

      .stats-note-paper {
        position: relative;
        width: 100%;
        height: 100%;
        box-sizing: border-box;
        padding: 0.95rem;
        background: rgba(255, 248, 232, 0.9);
        box-shadow:
          5px 5px 15px rgba(0, 0, 0, 0.1),
          inset 0 0 30px rgba(255, 255, 255, 0.5);
      }

      .stats-note-content {
        height: 100%;
        width: 100%;
        overflow-y: auto;
        padding-top: 0.9rem;
        color: #444444;
        white-space: pre-wrap;
        font-family: "PING FANG SHAO HUA", "PingFang SC", "Microsoft YaHei", sans-serif;
      }

      .stats-note-date {
        font-size: calc(1.08rem * var(--app-font-scale, 1));
        font-weight: 700;
        margin-bottom: 0.55rem;
        color: #555555;
        border-bottom: 1px dashed #cccccc;
        padding-bottom: 0.32rem;
      }

      .stats-note-body {
        font-size: calc(0.95rem * var(--app-font-scale, 1));
        line-height: 1.62;
        color: #444444;
        white-space: pre-wrap;
      }

      .stats-note-loading {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        color: #555555;
        font-family: "PING FANG SHAO HUA", "PingFang SC", "Microsoft YaHei", sans-serif;
      }

      .stats-note-loading-text {
        position: relative;
        font-size: calc(1.22rem * var(--app-font-scale, 1));
        letter-spacing: 2px;
        padding-right: 1.6em;
        line-height: 1.1;
      }

      .stats-note-loading-text::after {
        content: '';
        position: absolute;
        right: 0;
        top: 0;
        width: 1.5em;
        text-align: left;
        animation: stats-note-dots 1.5s steps(5, end) infinite;
      }

      @keyframes stats-note-dots {
        0%, 20% { content: ''; }
        40% { content: '.'; }
        60% { content: '..'; }
        80%, 100% { content: '...'; }
      }

      .stats-note-loading-quill {
        width: 3rem;
        height: auto;
        position: absolute;
        right: 0.25rem;
        bottom: 0.95rem;
        transform-origin: 5% 95%;
        animation: stats-note-writing 1.2s ease-in-out infinite;
        pointer-events: none;
      }

      .stats-note-loading-quill svg {
        display: block;
        width: 100%;
        height: auto;
      }

      .stats-note-quill-path {
        fill: #444444;
      }

      @keyframes stats-note-writing {
        0% {
          transform: rotate(0deg) translate(0, 0);
        }
        25% {
          transform: rotate(10deg) translate(2px, -2px);
        }
        50% {
          transform: rotate(-5deg) translate(4px, 0);
        }
        75% {
          transform: rotate(5deg) translate(2px, -1px);
        }
        100% {
          transform: rotate(0deg) translate(0, 0);
        }
      }

      input[type='range'].app-range {
        -webkit-appearance: none;
        appearance: none;
        background: transparent;
        display: block;
        height: 18px !important;
        margin: 0;
        padding: 0;
      }

      input[type='range'].app-range:focus {
        outline: none;
      }

      input[type='range'].app-range::-webkit-slider-runnable-track {
        height: 8px;
        border-radius: 9999px;
        background: transparent;
      }

      input[type='range'].app-range::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        margin-top: calc((8px - 18px) / 2);
        border-radius: 50%;
        border: 1px solid rgb(var(--theme-300) / 0.9);
        background: rgb(var(--theme-400) / 1);
        box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.2), 0 0 0 1px rgb(var(--theme-100) / 0.35);
        cursor: pointer;
      }

      .dark-mode input[type='range'].app-range::-webkit-slider-thumb {
        border-color: rgb(var(--theme-300) / 0.75);
        box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.45), 0 0 0 1px rgb(var(--theme-900) / 0.35);
      }

      input[type='range'].app-range::-moz-range-track {
        height: 8px;
        border-radius: 9999px;
        background: transparent;
      }

      input[type='range'].app-range::-moz-range-thumb {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        border: 1px solid rgb(var(--theme-300) / 0.9);
        background: rgb(var(--theme-400) / 1);
        box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.2), 0 0 0 1px rgb(var(--theme-100) / 0.35);
        cursor: pointer;
      }

      .dark-mode input[type='range'].app-range::-moz-range-thumb {
        border-color: rgb(var(--theme-300) / 0.75);
        box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.45), 0 0 0 1px rgb(var(--theme-900) / 0.35);
      }

      input[type='range'].app-range::-moz-range-progress {
        background: transparent;
      }

@tailwind utilities;
